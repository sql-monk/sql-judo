---
layout: default
title: "Чистий розум"
---

# SQL Judo. Чистий розум — Про фільтрацію даних

> *«Битва виграється не силою удару, а точністю попадання.»*
![mind](mind.png)
---


#### **Пошук в тексті**

```sql
-- ПОГАНО: пошук з лівим wildcards не використовує індекс
WHERE ProductName LIKE '%Phone%'

-- ДОБРЕ: якщо можливо, пошук з початку рядка
WHERE ProductName LIKE 'iPhone%'

-- АЛЬТЕРНАТИВА: Full-Text Search для складних текстових пошуків
WHERE CONTAINS(ProductName, 'iPhone')
```

#### **чим замінити OR?**

```sql
-- ПОГАНО: OR може призвести до повного сканування таблиці
WHERE CategoryID = 1 OR CategoryID = 5 OR CategoryID = 10

-- ДОБРЕ: IN більш ефективний
WHERE CategoryID IN (1, 5, 10)

-- АБО: UNION ALL для різних типів умов
SELECT * FROM Products WHERE CategoryID = 1
UNION ALL
SELECT * FROM Products WHERE ProductName LIKE 'Special%'
```

```sql
-- ПОГАНО:
WHERE ReciveAccId <> 0 OR AccId <> 0

-- ДОБРЕ:
WHERE ReciveAccId + AccId > 0
```
 
---

 

## EXISTS, NOT EXISTS
 

`EXISTS` використовується, коли потрібно **перевірити факт існування** хоча б одного рядка, що відповідає умові, у підзапиті.
SQL Server зупиняє перевірку **на першому ж знайденому збігу**, що робить цей підхід ефективним для перевірки наявності.

**Приклад EXISTS:**

```sql
SELECT o.OrderID, o.CustomerID
FROM dbo.Orders o
WHERE EXISTS (
    SELECT 1
    FROM dbo.VIPCustomers v
    WHERE v.CustomerID = o.CustomerID
)
```

*Працює швидко, не витягує зайві дані з підзапиту.*

---

**Приклад NOT EXISTS (пошук відсутніх зв’язків):**

```sql
SELECT c.CustomerID, c.CustomerName
FROM dbo.Customers c
WHERE NOT EXISTS (
    SELECT 1
    FROM dbo.Orders o
    WHERE o.CustomerID = c.CustomerID
)
```

*Зручно для пошуку клієнтів без замовлень.*

---

### EXISTS vs JOIN

* **JOIN** з’єднує дані та повертає всі збіги — навіть якщо їх декілька, вони дублюватимуть основний рядок.
* **EXISTS** перевіряє лише факт існування — без дублювання і без витягування зайвих стовпців.
* JOIN може бути швидшим, якщо дані з обох таблиць потрібні у вихідному наборі.
* EXISTS зазвичай виграє у випадках, коли потрібна лише перевірка умови, а не повний набір з'єднаних даних.

---

**JOIN (повертає дублікати):**

```sql
SELECT o.OrderID, o.CustomerID
FROM dbo.Orders o
JOIN dbo.VIPCustomers v
    ON o.CustomerID = v.CustomerID
```

*Поверне по рядку на кожен збіг, навіть якщо їх багато.*

---

**Документація:**

* [EXISTS (Transact-SQL) — Microsoft Learn](https://learn.microsoft.com/uk-ua/sql/t-sql/language-elements/exists-transact-sql?view=sql-server-ver17)
* [JOIN — Microsoft Learn](https://learn.microsoft.com/uk-ua/sql/t-sql/queries/from-transact-sql?view=sql-server-ver17#join)

---
 
